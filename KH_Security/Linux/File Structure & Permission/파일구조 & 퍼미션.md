# File Structure & Permission

---

## File Structure

![01](/KH_Security/Linux/File%20Structure%20%26%20Permission/img/01.png)

| 퍼미션 | 하드링크 수 | 소유자 | 그룹소유자 | 크기 | 변경 일자 | 파일명 |
| --- | --- | --- | --- | --- | --- | --- |
| `-rw-------` | `1` | `root` | `root` | `1517` | `12월 31 14:49` | `anaconda-ks.cfg` |

```text
퍼미션
- 소유자 : 파일을 만든 사용자(Owner)의 권한 (rwx)
위치 : 2 ~ 4
- 그룹 : 파일이 속한 그룹(Group) 멤버들의 권한 (rwx)
위치 : 5 ~ 7
- 기타 (Others) : 그 외 나머지 모든 제3자의 권한 (rwx)
위치 : 8 ~ 10
```

### 파일의 종류

| 기호 | 파일 종류 |
| --- | --- |
| - | 일반 파일 |
| d | 디렉터리 |
| l | 링크 파일 |
| b | 블록 디바이스 파일 |
| c | 문자 디바이스 파 |

---

## 권한 기호 및 값

- 각 자리에 들어가는 기호는 다음과 같은 의미와 8진수 값을 가집니다.

| 기호 | 의미 | 설명 | 숫자 값 |
|:---:|:---:|:---|:---:|
| `r` | Read | 읽기 권한 | 4 |
| `w` | Write | 쓰기/수정 권한 | 2 |
| `x` | Execute | 실행 권한 | 1 |
| `-` | None | 권한 없음 | 0 |

- 리눅스에서는 같은 `rwx` 기호라도 대상이 파일인지 디렉토리인지에 따라 다르게 해석됩니다.

| 구분 | 파일 (File) | 디렉토리 (Directory) |
|:---:|:---|:---|
| `r` | 파일의 내용을 볼 수 있음 | 디렉토리 내 파일 리스트 확인 가능 |
| `w` | 파일의 내용을 수정할 수 있음 | 디렉토리 내 파일 생성 및 삭제 가능 |
| `x` | 파일을 프로그램으로 실행 가능 | `cd` 명령어로 해당 디렉토리 진입 가능 |

---

## 파일 권한 확인

```text
ls -l *.cfg
```

![02](/KH_Security/Linux/File%20Structure%20%26%20Permission/img/02.png)

---

## 디렉터리 파일

```text
ls -al | grep ^d
```

![03](/KH_Security/Linux/File%20Structure%20%26%20Permission/img/03.png)

---

## 문자 디바이스 파일

```text
ls -l vcs
```

![04](/KH_Security/Linux/File%20Structure%20%26%20Permission/img/04.png)

--- 

## 심볼릭 링크 파일

```text
ls -l stderr
```

![05](/KH_Security/Linux/File%20Structure%20%26%20Permission/img/05.png)

---

## 퍼미션 제어 

### chmod 명령어

```text
chmod  [옵션]  [퍼미션 ]  [파일]

옵션
  - R : 디렉토리인 경우 하위 디렉토리와 파일까지 수정
```

```text
대상 : u(user), g(group), o(other), a(all)
operator : + (추가), - (삭제), = (지정항목만 설정한다. chattr과 동일)
퍼미션 : r,w,x,s,t
```

### 퍼미션 권한 숫자 계산

- 원하는 권한 조합의 숫자를 모두 더하면 해당 사용자의 권한 숫자가 됩니다.

`ex) rwx / r-x  / r--`

- 세개씩 나누어서 계산합니다.

- 7 (4+2+1): rwx
- 6 (4+2+0): rw-
- 5 (4+0+1): r-x
- 4 (4+0+0): r--

- `chmod` 명령어에서 사용하는 세 자리 숫자는 다음을 의미합니다.

| 위치 | 대상 | 의미 |
| --- | --- | --- |
| 첫 번째 | 소유자 (User) | 파일을 소유한 사용자의 권한 |
| 두 번째 | 그룹 (Group) | 파일이 속한 그룹의 권한 |
| 세 번째 | 기타 (Others) | 그 외 나머지 사용자의 권한 |

---

## Permission 권한 실습

```text
chmod 755 test.txt

소유자 : 읽기/쓰기/실행
그룹 : 읽기/실행
기타 사용자 : 읽기/실행
```

![06](/KH_Security/Linux/File%20Structure%20%26%20Permission/img/06.png)

```
-rw-r--r-- -> -rwxr-xr-x 바뀐 것을 확인할 수 있습니다.
```

---

## 소유자 및 그룹소유자 변경

```text
# chown  [-R]  [유저명]  [대상]
# chown  [-R]  [유저명].[그룹명]  [대상] - 비표준명령
# chgrp  [-R]  [그룹명]  [대상]
```

- 파일 소유자 변경
```text
chown st01 test.txt
```
![07](/KH_Security/Linux/File%20Structure%20%26%20Permission/img/07.png)

- 파일 소유 그룹 변경
```text
chgrp st test.txt
```
![08](/KH_Security/Linux/File%20Structure%20%26%20Permission/img/08.png)

---

## chown 확장 사용법

| 형식 | 명령어 예시 | 설명 |
|:---|:---|:---|
| 소유자만 변경 | chown st01 a.txt | 소유자 변경 |
| 그룹만 변경 | chown .root a.txt | 그룹 변경 |
| 동시 변경 | chown st01.st a.txt | 소유자/그룹 변경 |

- 콜론(:) 사용도 동일하게 동작합니다.
```text
chown :root test.txt
```
- 재귀적 변경
```text
chown -R st01.root /
```
---

## 최종 소유권 변경 예제

- 소유자와 그룹을 root로 변경
```text
chown st01.st test.txt
```
![09](/KH_Security/Linux/File%20Structure%20%26%20Permission/img/09.png)

- 그룹만 변경
```text
chown .root test.txt
```
![10](/KH_Security/Linux/File%20Structure%20%26%20Permission/img/10.png)

---
