# JOIN

## JOIN이란?
- JOIN은 **여러 테이블에 흩어진 데이터를 관계 조건으로 연결해 하나의 결과로 만드는 수식**이다.


### 역할 
- RDB에서 **정규화로 분리된 테이블을 다시 의미 있는 데이터로 복원**
- 실무 쿼리의 핵심

### 기능 (Function)
- 테이블 간 **공통 컬럼(FK, 관계 컬럼)** 을 기준으로 행을 연결
- SELECT 결과의 정보량 확장

### JOIN이 왜 필요한가?

- 관계형 데이터베이스(RDB)는 **데이터 중복을 줄이기 위해 테이블을 분리(정규화)** 합니다.
- 이로 인해 하나의 정보가 여러 테이블에 나뉘어 저장됩니다.
- JOIN은 이렇게 분리된 데이터를 **관계 조건을 기준으로 다시 결합하여 의미 있는 결과를 생성**합니다.

### JOIN 사용 시 주의사항

- FROM 절에 기술된 모든 테이블은 **반드시 조인 조건으로 연결되어야 합니다.**
- 조인 조건이 누락되면 Cartesian Product가 발생할 수 있습니다.
- 동일한 컬럼명이 여러 테이블에 존재할 경우 **반드시 테이블명 또는 별칭을 명시해야 합니다.**

---

## 등가 조인

### 개념 설명

```text
- 등가 조인은 관계형 데이터베이스에서 가장 기본적인 조인 방식으로,  
  두 테이블 간의 공통 컬럼(PK–FK 관계) 을 기준으로 정확히 일치하는 값만 연결합니다.  
- 정규화로 분리된 테이블을 의미 있는 하나의 결과 집합으로 복원하는 데 사용됩니다.
```

### 작성 시 주의사항

```text
- FROM 절에 등장한 모든 테이블은 반드시 조인 조건을 가져야 합니다.
- 동일한 이름의 컬럼이 여러 테이블에 존재하면 테이블명 또는 별칭을 명시해야 합니다.
- 조인 조건이 누락되면 Cartesian Product가 발생할 수 있습니다.
```

- **각 사원의 근무 부서와 근무지를 검색하는 예시**
```sql
  SELECT d.dno 부서번호, dname 부서, loc 근무처, 
  eno 사번, ename 이름
  FROM dept d, emp e
  WHERE d.dno=e.dno;
```

---

## 비등가 조인

### 개념 설명

```text
- 비등가 조인은 두 테이블을 연결할 때 값이 정확히 일치하는 것이 아니라,
  어떤 값이 특정 범위에 포함되는지를 기준으로 연결합니다.
- 따라서 PK = FK 같은 고정된 관계보다는 구간, 등급, 범위 매핑에 주로 사용됩니다.
```

### 작성 시 주의사항
```text
- 조인 조건이 범위 조건이므로 조건을 잘못 작성하면 결과가 왜곡될 수 있습니다.
- 하나의 행이 여러 범위에 동시에 속하지 않도록 범위 정의가 명확해야 합니다.
- FROM 절에 사용된 모든 테이블은 반드시 조인 조건으로 연결해야 합니다.
```

- **각 사원의 급여 등급을 검색하는 예시**
```sql
  SELECT eno, ename, sal, grade
  FROM emp e, salgrade s
  WHERE sal BETWEEN losal AND hisal;
```

- **총무 부서의 사원의 급여를 10% 인상했을 때 사원의 급여등급 검색 예시**
```sql
  SELECT d.dno, dname, eno, ename, sal, sal*1.1, grade
  FROM dept d, emp e, salgrade s
  WHERE d.dno = e.dno
  AND sal*1.1 BETWEEN losal AND hisal
  AND dname = '총무';
```

---

## JOIN 문을 쉽게 하는 법

- 테이블의 구조와 관계를 숙지하면 쉽게 작성할 수 있습니다.

### 테이블 상세 구조
<table>
<tr>
<td valign="top">

#### emp (사원)

| 컬럼 | 내용 |
|---|---|
| eno | 사번 |
| ename | 이름 |
| sex | 성별 |
| job | 업무 |
| mgr | 사수사번 |
| hdate | 입사일 |
| sal | 급여 |
| comm | 보너스 |
| dno | 부서번호 |

</td>
<td valign="top">

#### dept (부서)

| 컬럼 | 내용 |
|---|---|
| dno | 부서번호 |
| dname | 부서명 |
| loc | 지역 |

</td>
<td valign="top">

#### salgrade (급여등급)

| 컬럼 | 내용 |
|---|---|
| grade | 등급 |
| losal | 하한값 |
| hisal | 상한값 |

</td>
<td valign="top">

#### scgrade (점수등급)

| 컬럼 | 내용 |
|---|---|
| grade | 등급 |
| loscore | 하한값 |
| hiscore | 상한값 |

</td>
</tr>

<tr>
<td valign="top">

#### student (학생)

| 컬럼 | 내용 |
|---|---|
| sno | 학번 |
| sname | 이름 |
| sex | 성별 |
| syear | 학년 |
| major | 학과 |
| avr | 평점(4.0) |

</td>
<td valign="top">

#### professor (교수)

| 컬럼 | 내용 |
|---|---|
| pno | 교수번호 |
| pname | 교수이름 |
| section | 소속학과 |
| orders | 직위 |
| hiredate | 부임일 |

</td>
<td valign="top">

#### course (과목)

| 컬럼 | 내용 |
|---|---|
| cno | 과목번호 |
| cname | 과목명 |
| st_num | 학점수 |
| pno | 교수번호 |

</td>
<td valign="top">

#### score (기말고사점수)

| 컬럼 | 내용 |
|---|---|
| sno | 학번 |
| cno | 과목번호 |
| result | 점수 |
</td>
</tr>
</table>

---

### 테이블 표현과 관계

![10](/KH_Security/SQL/img/10.png)

---

## 조인문 작성과정 (지문기준)

```text
STEP 1 : 검색대상과 조건을 추출합니다.
  - SELECT, WHERE, ORDER BY절 구성합니다.
STEP 2 : SELECT절과 WHERE 절에서 검색 테이블 추출합니다.
STEP 3 : 테이블간 관계 확인합니다.
  - 관계 확인을 통해 테이블이 추가될 수 있습니다.
STEP 4 : 조인 조건 기술합니다.
STEP 5 : 문장을 완성해줍니다.
  - SELECT 절에 내용이 추가됩니다.
```

### 작성과정 실습

- 예시 : 화학과 1학년 학생에게 강의하는 교수의 명단을 검색한다.

#### STEP 1 : 검색대상과 조건을 추출
- `검색 대상` : 교수명단 (PNO, PNAME)
- `조건` : 화학과 학생 (MAJOR ='화학'), 1학년 (SYEAR=1)

- SQL문 예시
```sql
  SELECT pno, pname
  FROM
  WHERE major = '화학' AND syear = 1;
```
- 이렇게 검색대상과 조건에 해당되는 절을 먼저 작성해줍니다.

#### STEP 2 : SELECT절과 WHERE 절에서 검색 테이블 추출
- PROFESSOR : PNO, PNAME
- STUDENT : MAJOR, SYEAR
 
- `SQL문 예시`
```sql
  SELECT pno, pname
  FROM student s, professor p
  WHERE major = '화학' AND syear = 1;;
```
- `student 테이블`과 `professor 테이블`을 `FROM절`에 삽입하였습니다.

#### STEP 3 : 테이블간 관계 확인
- `student 테이블`과 `professor 테이블`은 직접적인 관계가 없기 때문에  
`course 테이블`과 `score 테이블`이 필요합니다.

- `관계 확인`
```text
student.sno
    ↓
score.sno ── score.cno
                ↓
            course.cno ── course.pno
                                ↓
                           professor.pno
```

- 이렇게 관계 확인을 하면 조인 조건문을 기술하는데 편리합니다.

#### STEP 4 : 조인 조건 기술

- STEP 3에서 관계 확인한 걸 계기로 조인 조건문을 기술합니다.
```sql
  SELECT p.pno, pname
  FROM student s, score r, course c, professor p 
  WHERE s.sno=r.snoAND r.cno=c.cnoAND c.pno=p.pno
  AND  major = '화학' AND syear= 1;
```

#### STEP 5 : 문장을 완성한다.

- 이제 마지막으로 부족한 부분을 채워줍니다.
```sql
  SELECT DISTINCT p.pno, pname 화학과_1학년_학생에게_강의하는_교수명단
  FROM student s, score r, course c, professor p 
  WHERE s.sno=r.sno
  AND r.cno=c.cno
  AND c.pno=p.pno
  AND major = '화학' AND syear= 1;
```

- 이런 방법으로 하나하나 완성해가며 작성하면  
쉽게 조인문을 작성할 수 있습니다.
